# 사용자 관리와 파일 속성

## 사용자와 그룹
> - 리눅스는 다중 사용자 시스템(multi-user system)이다. -> 1대의 리눅스에 사용자 여러 명이 동시에 접속해서 사용할 수 있는 시스템이다.

> - 리눅스를 설치하면 기본적으로 root라는 이름을 가진 super user가 있다. 이 root사용자는 시슴템의 모든 작업을 실행할 수 있는 권한뿐만 아니라 시스템에 접속할 수 있는 사용자를 생성할 수 있는 권한도 있다.

> - 모든 사용자는 혼자서 존재하는 것이 아니라 하나 이상의 그룹에 소속되어 있어야 한다.

### /etc/passwd
> - /etc/passwd 파일를 보면 시스템 사용자 목록이 나와있다. 그 형식은
> - 사용자 이름:암호:사용자ID:사용자가 소속된 그룹ID:전체 이름:홈 디렉터리:기본 셸
> - 로 이루어져 있다.
> - 여기서암호가 x로 표시되어 있는것은 /etc/shadow 파일에 비밀번호가 지정되어 있다는 의미다.

### /etc/shadow
> - /etc/shadow 파일을 보면 사용자들의 암호가 코드화 되어있다. -> 같은 암호도 서로 다르게 코드화 된다 ->  root 사용자라 할지라도 사용자들의 비밀번호를 유추할 수 없다.-> But! root 사용자는 사용자들의 암호를 지정해 줄 수 있다.(4글자로도)

## 사용자 및 그룹과 관련된 명령어

### useradd(또는 adduser)
> - 새로운 사용자를 추가한다. 이 명령어를 실행하면 /etc/passwd, /etc/shadow, /etc/group 파일에 새로운 행이 추가된다.
> - -u : ID 지정
> - -g : 그룹 지정
> - -d : 홈 디렉터리 지정
> - -s : 기본 셸 지정

> - [사용 예]
> - useradd newuser -> newuser라는 이름의 사용자 생성
> - useradd -u 1111 newuser -> newuser 사용자를 생성하면서 사용자 ID를 1111로 지정
> - useradd -g mygroup newuser -> newuser 사용자를 생성하면서 mygroup 그룹에 newuser 사용자를 포함시킴(mygroup 그룹을 먼저 만들어 놓아야 함)
> - useradd -d /newhome newuser -> newuser 사용자를 생성하면서 홈 디렉터리를 /newhome으로 지정
> - useradd -s /bin/csh newuser -> newuser 사용자를 생성하면서 기본 셸을 /bin/csh로 지정

### passwd
> - 사용자의 비밀번호를 지정하거나 변경한다.
> - root 사용자는 모든 사용자의 비밀번호를 변경할 수 있지만, 일반 사용자들은 자신의 비밀번호만 바꿀 수 있다.

> - [사용 에
> - passwd newuser

### usermod
> - 사용자의 속성을 변경한다. 옵션은 useradd와 동일하다.

> - [사용 예]
> - usermod -g root newuser -> newuser 사용자의 그룹을 root 그룹으로 변경

### userdel
> - 사용자를 삭제한다.

> - [사용 예]
> - userdel newuser -> newuser 사용자를 삭제
> - userdel -r newuser -> newuser 사용자를 삭제하면서 홈 디렉터리까지 삭제

### chage
> - 사용자의 암호를 주기적으로 변경하도록 설정한다.

> - [사용 예]
> - chage -l newuser -> newuser 사용자에 설정된 사항을 확인
> - chage -m 2 newuser -> newuser 사용자에 설정한 암호를 사용해야 하는 최소일자(즉, 병경 후 최소 2일은 사용해야 함)
> - chage -M 30 newuser -> newuser 사용자에 설정한 암호를 사용할 수 있는 최대일자(즉, 변경 후 최대 30일 까지 사용할 수 있음)
> - chage -E 2019/12/12 newuser -> newuser 사용자에 성정한 암호가 만료되는 날짜(즉, 2019.12.12까지만 사용할 수 있음)
> - chage -W 10 newuser -> newser 사용자에 설정한 암호가 만료되기 전에 경고하는 기간. 지정하지 않았을 경우 기본 값은 7일(즉, 암호가 만료되기 10일 전부터 경고 메시지가 나감)

### groups
> - 사용자가 소속된 그룹을 보여준다.

> - [사용 예]
> - groups -> 현재 사용자가 소속된 그룹을 보여줌
> - groups newuser -> newuser가 소속된 그룹을 보여줌

### groupsadd
> - 새로운 그룹을 생성한다.

> - [사용 예]
> - groupadd newgroup -> newgroup이라는 그룹을 생성
> - groupadd -g 2222 newgroup -> newgroup 그룹을 생성하면서 그룹 ID를 2222로 지정

### groupmod
> - 그룹의 속성을 변경한다.

> - [사용 예]
> - groupmod -n newgroup mygroup -> 그룹의 이릉을 mugroup으로 변경

### groupdel
> - 그룹을 삭제한다.

> - [사용 예]
> - groupdel newgroup -> newgroup 그룹을 삭제(단, 해당 그룹을 주요 그룹으로 지정한 사용자가 없어야 한다.).

### gpasswd
> - 그룹의 암호를 성정하거나 그룹 관리를 수행한다.

> - [사용 예]
> - gpasswd newgroup -> newgroup 그룹의 암호를 지정
> - gpasswd -A newuser newgroup - > newuser 사용자를 newgroup 그룹의 관리자로 지정
> - gpasswd -a user1 newgroup -> user1을 newgroup 그룹의 사용자로 추가
> - gpasswd -d newuser newgroup -> user1을 newgroup 그룹의 사용자에서 제거

## 파일과 디렉터리의 소유와 허가권
> - 리눅스는 각각의 파일과 디렉터리마다 소유권과 허가권이라는 속성이 있다.
> - root 사용자가 자신의 홈 디렉터리에서 'ls -l'을 실행 하면 다음과 같이 나온다.
> - - rw- r-- r-- 1 root root 0 12월 1 20:54 sample.txt
> - 파일유형 파일허가권 링크수 파일소유자이름 파일소유그룹이름 파일크기(Byte) 마지막 변경 날짜/시간 파일이름

### 파일 유형
> 파일이 어떤 종류의 파일인지를 나타낸다. 
> - 'd' : 디렉터리
> - '-' : 일반적인 파일
> - 'b' : 블록 디바이스
> - 'c' : 문자 디바이스
> - 'l' : 링크

#### 용어
> - 블록 디바이스 : 하드디스크, 프로피 디스크, CD/DVD 등의 저장장치
> - 문자 디바이스 : 마우스, 키보드, 프린터 등의 입출력 장치

### 파일 허가권
> 파일 허가권은 'rw-', 'r--', 'r--' 3개씩 끊어서 인식하면 된다.
> -  1번째는 소유자의 파일 접근 권한, 2번째는 그룹의 파일 접근 권한, 3번째는 그 외 사용자의 파일 접근 권한을 의미한다.
> - 'r' : read
> - 'w' : write
> - 'x' : execute

#### 파일의 허가권은  이진수로도  표현할 수 있다. 예를 들어 소유자의 허가권이 6이라면 2진수로 110이므로 'rw-'에 해당된다.

#### 여기서 잠깐
> Windows의 경우 .exe는 실행 파일, .txt는 텍스트 파일 등 확장명으로 해당 파일의 종류를 판단하지만, 리눅스는 확장자에 별 의미를 두지 않는다. 즉, 실행 파일이건 텍스트 파일이건 모두 일반적으로 확장명을 갖지 않는다. 확장명을 갖더라고 편리함을 위함이지 확장명이 파일의 종류를 판단하는 절대적인 의미는 아니다.

#### chmod
> 파일 허가권을 변경하는 명령어

> - 옵션
> - u : 사용자
> - g : 그룹
> - 0 : 그외의 사용자
> - - : 해당 권한을 없애라
> - + : 해당 권한을 허가해라
> - r : 읽기 권한을
> - w : 쓰기 권한을
> - x : 실행 권한을
##### 위의 ugo의 순서가 바뀌어도 상관 없다.


> - [사용 예]
> - chmod 777 sample.txt -> sample.txt 파일은 모든 사용자가 읽고, 쓰고, 실행할 수 있는 파일이 된다.
> - chmod u+x sample.txt -> 소유자에게 sample.txt 파일의 실행 권한을 허가

### 파일 소유권
> 파일 소유권은 파일을 소유한 사용자와 그룹을 의미한다.

#### chown
> 파일의 소유권을 바꾸는 명령어
> - 형식 : chown 새로운사용자이름(.새로운그룹이름) 파일이름

> - [사용 예]
> - chown centos.centos sample.txt -> 파일의 소유자를 centos 사용자로 바꾸고 파일의 그룹도 centos 그룹으로 바꾼다.

### 링크
> 파일의 링크는 하드 링크와 심볼릭 링크 2가지가 있다.
> - 하드 링크는 원본 파일과 같은 inode와 실제 데이터를  가진다. 그렇기 때문에 원본 파일의 위치가 바뀌어도 실행 가능하다.
> - 반면에 심볼릭 링크(소프트 링크)는 원본 파일과 다른 inode를  가지고, 원폰 파일을 포인터를 저장하고 있기 때문에 원본파일의 위치가 바뀌면 실행이 불가능하다.
> - 하드 링크 생성 : ln 링크대상파일이름 링크파일이름
> - 심볼릭 링크 생성 : ln -s 링크대상파일이름 링크파일이름

#### 여기서 잠깐
> inode : 리눅스/유닉스의 파일 시스템에서 사용하는 자료구조를 말하는데, 파일이나 디렉터리의 여러가지 정보가 있다. 모든 파일이나 디렉터리는 각자 1개씩의 inode가 있으며, 각 inode에는 해당 파일의 소유권, 허가권, 파일 종류 등의 정보와 해당 파일의 실제 데이터가 어디에 있는지 위치도 있다.

